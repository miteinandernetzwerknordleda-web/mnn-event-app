<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lokale Events App</title>
<style>
* {
    box-sizing: border-box; /* WICHTIG: Stellt sicher, dass Padding und Border zur Gesamtbreite gehören */
}
/* 1. GLOBALE STILE */
    body {
        font-family: 'Roboto', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        margin: 0;
        padding: 0;
        background-color: #f4f7f6; 
        color: #333;
        line-height: 1.6;
        min-height: 100vh;
        display: flex;
        flex-direction: column;
        
        overflow-y: scroll; 
        
        /* NEU: Horizontales Scrollen verbieten */
        overflow-x: hidden; 
    }

	.spinner {
        border: 4px solid rgba(0, 0, 0, 0.1);
        border-left-color: #8B4513; /* Die Farbe des Header-Braun verwenden */
        border-radius: 50%;
        width: 40px;
        height: 40px;
        animation: spin 1s linear infinite;
        margin: 0 auto; /* Zentrieren des Spinners */
    }

    @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }

/* 2. HEADER UND CONTAINER (Aktualisiert für Logo) */

    #app-container {
        max-width: 600px;
        width: 100%;
        margin: 0 auto;
        padding-bottom: 80px;
        flex-grow: 1;
        background-color: #fff;
        box-shadow: 0 0 20px rgba(0, 0, 0, 0.05);
    }

    #app-header { /* Die ID header wurde zu app-header */
        background-color: #8B4513;
        color: white;
        padding: 10px 20px; /* Padding reduziert, um Platz zu sparen */
        display: flex; /* Flexbox für nebeneinanderliegende Elemente */
        align-items: center; /* Vertikale Zentrierung */
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        position: sticky;
        top: 0;
        z-index: 10;
    }

    #app-logo {
        height: 40px; /* Höhe des Logos definieren */
        width: auto;
        margin-right: 15px; /* Abstand zum Titel */
    }
    
    #headerTitle { /* H1-Tag für den Titel */
        margin: 0;
        padding: 0;
        font-size: 1.5em; /* Etwas kleiner für besseres Layout */
        font-weight: bold;
        color: white;
        flex-grow: 1; /* Nimmt den restlichen Platz ein */
        text-align: left; /* Text links vom Logo */
    }

	#search-container {
        max-width: 600px;
        width: 100%;
        margin: 0 auto;
        padding: 10px 20px;
        background-color: #f4f7f6; /* Heller Hintergrund */
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
        z-index: 5;
    }

    #searchInput {
        width: 100%;
        padding: 10px 15px;
        border: 1px solid #ddd;
        border-radius: 20px; /* Abgerundete Ecken */
        font-size: 1em;
        box-sizing: border-box; /* Wichtig, damit das Padding die Breite nicht sprengt */
        transition: border-color 0.3s;
    }

    #searchInput:focus {
        outline: none;
        border-color: #8B4513; /* Fokus-Farbe: Braun */
        box-shadow: 0 0 0 2px rgba(139, 69, 19, 0.2);
    }

/* 3. KARTEN-STIL */
    .card {
        background: white;
        padding: 15px;
        border-radius: 8px; 
        border: 1px solid #ddd; /* NEU: Dünner, hellgrauer Rahmen */
        border-left: 10px solid #007bff; /* Behält den farbigen Rand */
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.05); 
        transition: transform 0.2s, box-shadow 0.2s;
        cursor: pointer;
    }

	.card:hover {
        transform: translateY(-2px);
        /* NEU: Box-Shadow verwendet die dynamisch gesetzte CSS-Variable */
        /* Wir fügen einen leichten Schatten und eine Kontur in der Event-Farbe hinzu */
        box-shadow: 0 6px 15px rgba(0, 0, 0, 0.1), 
                    0 0 0 2px var(--event-color); 
    }

    .card h3 {
        margin-top: 0;
        margin-bottom: 8px;
        color: #8B4513;
        font-size: 1.1em;
    }

    .card p {
        margin: 4px 0;
        font-size: 0.9em;
        color: #000000;
    }

/* 3. KARTEN-STIL (Ergänzung für Datum) */
    
    /* Der eigentliche Inhalt der Karte */
    .card-content {
        flex-grow: 1; 
        /* NEU: Abstand von 15px auf 25px erhöht */
        padding-left: 25px; 
    }

    /* Container für das Tagesdatum und den Wochentag */
    .date-container {
        display: flex;
        flex-direction: column; 
        align-items: center;
        text-align: center;
        width: 40px; 
        /* NEU: margin-right auf 0px gesetzt (zieht es nicht mehr nach links) */
        margin-right: 0px; 
        color: #333;
        padding-top: 5px; 
    }

	/* Große Zahl für den Tag */
    .date-day-num {
        font-size: 1.8em;
        font-weight: 700; 
        line-height: 1;
        color: #8B4513; 
    }

    /* Kurzes Kürzel für den Wochentag */
    .date-day-short {
        /* NEU: Obere Marge hinzugefügt (z.B. 4px) */
        margin-top: 12px; 
        font-size: 1.2em;
        font-weight: 600;
        text-transform: uppercase;
        line-height: 1;
    }

    /* 4. NAVIGATION */
    #navigation {
        position: fixed;
        bottom: 0;
        left: 0;
        right: 0;
        max-width: 600px;
        margin: 0 auto;
        display: flex;
        background-color: #343a40; /* Dunkle Navigationsleiste */
        box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.1);
        border-top-left-radius: 12px;
        border-top-right-radius: 12px;
        z-index: 20;
    }

    .nav-btn {
        flex: 1;
        padding: 15px 10px;
        color: white;
        text-align: center;
        text-decoration: none;
        font-size: 1em;
        cursor: pointer;
        transition: background-color 0.3s;
        border-radius: 0;
        border: none;
        background: none;
    }

    .nav-btn:hover {
        background-color: #495057;
    }

    .nav-btn.active {
        background-color: #8B4513;
        font-weight: bold;
    }

/* 5. MODAL-STIL (KORRIGIERTE, SICHERE VERSION) */

    .modal {
        display: none;
        position: fixed;
        z-index: 100;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        overflow: auto;
        background-color: rgba(0, 0, 0, 0.4);
    }

    .modal-content {
        /* WICHTIG: position: relative, padding-top: 40px und dergleichen ENTFERNEN */
        background-color: #fefefe;
        margin: 15% auto;
        padding: 25px; /* Standard-Padding wiederhergestellt */
        border-radius: 10px;
        width: 90%;
        max-width: 450px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        animation-name: animatetop;
        animation-duration: 0.4s
    }

    @keyframes animatetop {
        from {top: -300px; opacity: 0}
        to {top: 15%; opacity: 1}
    }
    
    .close {
        color: #555;
        float: right; /* Nur float: right; nutzen */
        font-size: 36px; /* Bleibt groß */
        font-weight: 300; 
        line-height: 1;
        margin-top: -10px; /* Leichte Korrektur nach oben */
        margin-right: -5px; /* Leichte Korrektur nach rechts */
    }

    .close:hover,
    .close:focus {
        color: #000;
        text-decoration: none;
        cursor: pointer;
    }

    /* 6. RESPONSIVE ANPASSUNGEN (für kleinere Bildschirme) */
    @media (max-width: 600px) {
        #app-container {
            padding-bottom: 70px;
        }
        #navigation {
            border-top-left-radius: 0;
            border-top-right-radius: 0;
        }
	.modal-content {
        background-color: #fefefe;
        /* NEU: Maximale Breite für Mobile sicherstellen */
        margin: 10% auto; /* 10% Abstand oben, zentriert horizontal */
        padding: 20px;
        border: 1px solid #888;
        border-radius: 10px;
        /* WICHTIG für Mobile: Breite auf 90% des Viewports setzen, 
           aber nie breiter als 600px */
        width: 90%; 
        max-width: 600px; 
        
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
    }
	
/* 6. MODAL STIL (Ergänzung für Bilder) */

.event-image-container {
    text-align: center;
    margin: 15px 0;
    border: 1px solid #ddd;
    border-radius: 5px;
    overflow: hidden;
    /* Füge diese Regel hinzu, um sicherzustellen, dass die Höhe durch den Inhalt bestimmt wird */
    height: auto; 
}

.event-image {
    /* Begrenzt die Bildgröße auf die Modalfensterbreite */
    max-width: 100%; 
    
    /* Wichtig: Erzwingt korrekte Höhenskalierung und ignoriert kleine Standardwerte */
    height: auto !important; 
    
    display: block; 
    
    /* Optional: Füge eine kleine Mindesthöhe hinzu, falls height: auto ignoriert wird */
    min-height: 50px; 
}
	
    }
</style>
</head>
<body>

<div class="container">
<header id="app-header">
    <div id="logo-container">
        <img id="app-logo" src="logo.png" alt="Vereins Logo"> 
    </div>
    <h1 id="headerTitle">Veranstaltungen</h1> 
</header>

<div id="search-container">
    <input type="text" id="searchInput" placeholder="Events, Anbieter oder Ort suchen...">
</div>

<div id="app-loader" style="text-align: center; padding-top: 50px;">
    <div class="spinner"></div>
    <p style="margin-top: 15px; color: #666;">Veranstaltungen werden geladen...</p>
</div>

    <div id="app-content" style="padding-bottom: 70px;">
        </div>

<div id="eventModal" class="modal">
    <div class="modal-content">
        <span class="close" onclick="closeModal('eventModal')">&times;</span> 
        </div>
</div>

<div id="veranstalterModal" class="modal">
    <div class="modal-content" id="veranstalterDetail">
        <span class="close" onclick="closeModal('veranstalterModal')">&times;</span>
        
        <h3 id="modalProviderName"></h3>
        <p><strong>Kontakt:</strong> <span id="modalProviderContact"></span></p>
        <p><strong>Info:</strong> <span id="modalProviderInfo"></span></p>
        <a id="modalProviderLink" href="#" target="_blank" style="color: #8B4513;">Zur Webseite</a>
        </div>
</div>
    
    <nav id="navigation">
        <button id="events-btn" class="nav-btn active" onclick="switchView('events')">Veranstaltungen</button>
        <button id="providers-btn" class="nav-btn" onclick="switchView('providers')">Anbieter</button>
    </nav>
	
</div>


<script>
    // --- 1. KONFIGURATION (HIER MÜSSEN SIE ERSETZEN!) ---
    // Siehe Anleitung von Google zur Erstellung eines API-Schlüssels und zur Kalender-ID
    const API_KEY = 'AIzaSyDDsCuRzCYH-U3tjoTu1VCiv641zY7K4Cc'; 
    const CALENDAR_ID = 'miteinander.netzwerk.nordleda@gmail.com'; 
// Basisdaten für die Anbieter (Verwenden Sie Eindeutige IDs!)
    const providers = [
        { id: 1, name: "TSV Nordleda", contact: "Jürgen Hoberg Tel. 04758-546", info: "Der lokale Sportverein mit verschiedenen Angeboten", link: "https://www.nordleda.de/vereine-und-choere/tsv-nordleda-ev/", color: "#a4bdfc" },
        { id: 2, name: "DRK Nordleda", contact: "Anja von Bebern Tel. 04758-679", info: "Der DRK Ortsverein bietet mit dem Arbeitskreis viele verschiedene Veranstaltungen", link: "https://www.svnordleda.de/", color: "#ff887c" },
        { id: 3, name: "Schützenverein Nordleda", contact: "Über das Kontaktformular auf der Webseite", info: "Schützenverein Nordleda von 1953 e.V.", link: "https://www.svnordleda.de/", color: "#7ae7bf" },
        { id: 4, name: "Kirchengemeinde Nordleda", contact: "meike.mueller-bilgenroth@evlka.de", info: "Die Kirchengemeinde St. Nicolai in Nordleda", link: "https://www.kk-ch.de/gemeinden/nordleda/", color: "#dbadff" },
		{ id: 5, name: "taktlos-Chor", contact: "Über das Kontaktformular auf der Webseite", info: "...der a cappella Männerchor", link: "https://www.gruppe-taktlos.de/", color: "#5484ed" },
		{ id: 6, name: "LoGos-Chor Nordleda", contact: "Gunda Knust Tel. 04758-326", info: "Lobpreis-Gospelchor", color: "#8A2BE2" },
		{ id: 7, name: "FamilienHaven Nordleda", contact: "Serina Naß Tel. 015256302291", info: "Delfi Kurse - Fachkraft für Beikost, Elternvorbereitung, Säuglingspflege, Achtsamkeit", link: "https://www.instagram.com/delfinordleda/", color: "#fbd75b" },
		{ id: 8, name: "Werbegemeinschaft Nordleda", contact: "Hans-Hermann Ropers Tel. 04758-444", info: "Werbegemeinschaft des Ortes Nordleda", link: "https://www.gruppe-taktlos.de/", color: "#5484ed" },
		{ id: 9, name: "CDU Nordleda", contact: "Hans-Hermann Ropers Tel. 04758-444", info: "CDU Ortsverband Nordleda", link: "https://www.cdu-land-hadeln.de/ortsverbaende/nordleda/", color: "#000000" },
		{ id: 10, name: "SoVD Neuenkirchen/Nordleda", contact: "Über das Kontaktformular auf der Webseite", info: "Sozialverband Deutschland", link: "https://www.sovd-cuxhaven.de/verband-990125?verbandid=991896&cHash=f253ff976383e4a74d925e676582cb7b", color: "#D3D3D3" },
		{ id: 11, name: "Miteinander Netzwerk Nordleda", contact: "miteinander.netzwerk.nordleda@gmail.com", info: "Interessengruppe zur Stärkung des Gemeinschaftsgefüges", link: "https://sites.google.com/view/netzwerknordleda/start", color: "#EE00EE" },
		{ id: 12, name: "Feuerwehr Nordleda", contact: "info@feuerwehr-nordleda.de", info: "Freiwillige Feuerwehr und Jugendfeuerwehr Nordleda", link: "https://www.instagram.com/ffw_nordleda/?hl=de", color: "#FF0000" },
		{ id: 99, name: "Freier Anbieter", contact: "Evtl. über die Veranstaltungsbeschreibung", info: "verschiedene Anbieter von Veranstaltungen", color: "#F8F8FF" }

		// ... Fügen Sie alle weiteren Anbieter hier mit einer eindeutigen ID ein ...
    ];
	
	const contentDiv = document.getElementById('app-content');
    const headerTitle = document.getElementById('headerTitle');
	const searchInput = document.getElementById('searchInput');
    const eventModal = document.getElementById('eventModal');
    const veranstalterModal = document.getElementById('veranstalterModal');
	const appLoader = document.getElementById('app-loader');
    let dynamicEvents = []; 

    // --- 2. HILFSFUNKTIONEN ---

    function extractProviderId(titleString) {
        if (!titleString) return null;
        const match = titleString.trim().match(/\(ID:(\d+)\)/i);
        return match ? parseInt(match[1]) : null;
    }
    
    function cleanTitle(titleString) {
        if (!titleString) return 'Unbekanntes Event';
        return titleString.replace(/\s*\(ID:\d+\)\s*/i, '').trim();
    }

// --- 3. DATENABRUF VON GOOGLE KALENDER (KORRIGIERT FÜR LOADER) ---

function fetchCalendarEvents() {
    headerTitle.textContent = "Veranstaltungen"; // Titel bleibt statisch
    contentDiv.innerHTML = ''; 
    appLoader.style.display = 'block'; // Loader anzeigen

    const twoWeeksFromNow = new Date();
    twoWeeksFromNow.setDate(twoWeeksFromNow.getDate() + 14);
    const timeMaxParam = twoWeeksFromNow.toISOString();

    const API_URL = `https://www.googleapis.com/calendar/v3/calendars/${CALENDAR_ID}/events?key=${API_KEY}&timeMin=${(new Date()).toISOString()}&timeMax=${timeMaxParam}&singleEvents=true&orderBy=startTime`;

    fetch(API_URL)
        .then(response => {
            if (!response.ok) {
                appLoader.style.display = 'none'; // Bei Fehler ausblenden
                throw new Error(`HTTP error! status: ${response.status}. API-Schlüssel oder Kalender-ID prüfen.`);
            }
            return response.json(); 
        })
        .then(data => {
            dynamicEvents = data.items.map((item, index) => {
                // ... (Ihre gesamte Event-Mapping Logik bleibt hier unverändert) ...
                const rawTitle = item.summary || '';
                const providerId = extractProviderId(rawTitle);
                
                const isTimedEvent = !!item.start.dateTime;
                const eventStart = new Date(item.start.dateTime || item.start.date);
                
                let startDate;
                let endDate = ''; 

                if (isTimedEvent) {
                    startDate = eventStart.toLocaleDateString('de-DE', {
                        year: 'numeric', month: 'long', day: 'numeric', hour: '2-digit', minute: '2-digit'
                    }).trim(); 

                    endDate = new Date(item.end.dateTime).toLocaleTimeString('de-DE', {
                        hour: '2-digit', minute: '2-digit'
                    }).trim();

                } else {
                    startDate = eventStart.toLocaleDateString('de-DE', {
                        year: 'numeric', month: 'long', day: 'numeric'
                    }).trim();
                }

                const dayOfMonth = eventStart.getDate(); 
                const dayOfWeekShort = eventStart.toLocaleDateString('de-DE', {
                    weekday: 'short'
                }).slice(0, 2);

                return {
                    id: index, 
                    title: cleanTitle(rawTitle), 
                    date: startDate, 
                    endDate: endDate, 
                    dayOfMonth: dayOfMonth, 
                    dayOfWeekShort: dayOfWeekShort, 
                    location: item.location || 'Keine Angabe',
                    description: item.description || 'Keine weitere Beschreibung vorhanden.',
                    providerId: providerId,
                };
            });
            appLoader.style.display = 'none'; // Loader ausblenden, da Daten da sind
            renderEventList();
        })
        .catch(error => {
            headerTitle.textContent = "Fehler beim Laden!";
            contentDiv.innerHTML = `<p style="margin: 20px; color: red;">Konnte Events nicht laden: ${error.message}.</p>`;
            console.error("Error fetching events:", error);
        });
}
	
// --- 4. FUNKTIONEN ZUM RENDERN DER LISTEN (KORRIGIERT FÜR DATUM-SIDEBAR) ---

	function renderEventList() {
    headerTitle.textContent = "Veranstaltungen";
    contentDiv.innerHTML = ''; 
    if (dynamicEvents.length === 0) {
        contentDiv.innerHTML = `<p style="margin: 20px;">Keine zukünftigen Veranstaltungen gefunden.</p>`;
        return;
    }

    dynamicEvents.forEach(event => {
        const provider = providers.find(p => p.id == event.providerId);
        const providerName = provider ? provider.name : "Unbekannter Anbieter";
        
        const cardColor = provider ? provider.color : '#aaaaaa'; 

        const card = document.createElement('div');
        card.className = 'card';
        card.style.borderLeftColor = cardColor;
        card.style.setProperty('--event-color', cardColor); 
        
        // NEU: Innerer Flex-Container
        card.style.display = 'flex'; 
        card.style.alignItems = 'flex-start'; // Wichtig für vertikale Ausrichtung
        
        // NEU: Datums-Container
        card.innerHTML = `
            <div class="date-container">
                <div class="date-day-num">${event.dayOfMonth}</div>
                <div class="date-day-short">${event.dayOfWeekShort}</div>
            </div>
            <div class="card-content">
                <h3>${event.title}</h3>
                <p>Datum: ${event.date}</p>
                <p>Anbieter: <strong>${providerName}</strong></p>
            </div>
        `;
        
        card.onclick = () => showEventDetails(event);
        contentDiv.appendChild(card);
    });
}

    function renderProviderList() {
        headerTitle.textContent = "Anbieter";
        contentDiv.innerHTML = ''; 
        providers.forEach(provider => {
            const card = document.createElement('div');
            card.className = 'card';
            
            // Anpassung der Karte an die Flexbox-Struktur der Events:
            card.style.display = 'flex'; 
            card.style.alignItems = 'flex-start';
            
            const cardColor = provider.color || '#aaaaaa';
            
            // 1. Randfarbe setzen
            card.style.borderLeftColor = cardColor; 
            
            // 2. WICHTIG: Die Farbe für den Hover-Effekt als CSS-Variable setzen!
            card.style.setProperty('--event-color', cardColor); 
            
            // Leerer Datums-Container für Konsistenz (bleibt leer)
            card.innerHTML = `
                <div class="date-container" style="visibility: hidden;">
                    <div class="date-day-num">00</div> 
                    <div class="date-day-short">XX</div>
                </div>
                <div class="card-content">
                    <h3>${provider.name}</h3>
                    <p>Info: ${provider.info}</p>
                </div>
            `;
            card.onclick = () => showVeranstalterDetails(provider.id);
            contentDiv.appendChild(card);
        });
    }

// --- 4. FUNKTIONEN ZUM RENDERN DER LISTEN (Ergänzung für Filter) ---

function filterEvents() {
    const searchTerm = searchInput.value.toLowerCase().trim();
    
    if (document.getElementById('events-btn').classList.contains('active')) {
        // Filterlogik für Events
        const filteredEvents = dynamicEvents.filter(event => {
            const provider = providers.find(p => p.id == event.providerId);
            const providerName = provider ? provider.name.toLowerCase() : '';
            
            return event.title.toLowerCase().includes(searchTerm) ||
                   event.location.toLowerCase().includes(searchTerm) ||
                   providerName.includes(searchTerm);
        });
        renderFilteredEventList(filteredEvents);

    } else if (document.getElementById('providers-btn').classList.contains('active')) {
        // Filterlogik für Anbieter
        const filteredProviders = providers.filter(provider => {
            return provider.name.toLowerCase().includes(searchTerm) ||
                   provider.info.toLowerCase().includes(searchTerm);
        });
        renderFilteredProviderList(filteredProviders);
    }
}

// Erstellt eine gefilterte Liste (Basierend auf renderEventList)
function renderFilteredEventList(eventsToRender) {
    headerTitle.textContent = "Veranstaltungen";
    contentDiv.innerHTML = ''; 
    if (eventsToRender.length === 0) {
        contentDiv.innerHTML = `<p style="margin: 20px;">Keine Events gefunden, die dem Suchbegriff entsprechen.</p>`;
        return;
    }
    
    eventsToRender.forEach(event => {
        const provider = providers.find(p => p.id == event.providerId);
        const providerName = provider ? provider.name : "Unbekannter Anbieter";
        const cardColor = provider ? provider.color : '#aaaaaa'; 
        
        // Der Rest ist identisch mit der ursprünglichen renderEventList Logik
        const card = document.createElement('div');
        card.className = 'card';
        card.style.borderLeftColor = cardColor;
        card.style.setProperty('--event-color', cardColor); 
        card.style.display = 'flex'; 
        card.style.alignItems = 'flex-start';
        
        card.innerHTML = `
            <div class="date-container">
                <div class="date-day-num">${event.dayOfMonth}</div>
                <div class="date-day-short">${event.dayOfWeekShort}</div>
            </div>
            <div class="card-content">
                <h3>${event.title}</h3>
                <p>Datum: ${event.date}</p>
                <p>Anbieter: <strong>${providerName}</strong></p>
            </div>
        `;
        card.onclick = () => showEventDetails(event);
        contentDiv.appendChild(card);
    });
}

// Erstellt eine gefilterte Liste (Basierend auf renderProviderList)
function renderFilteredProviderList(providersToRender) {
    headerTitle.textContent = "Anbieter";
    contentDiv.innerHTML = ''; 
    
    providersToRender.forEach(provider => {
        const card = document.createElement('div');
        card.className = 'card';
        card.style.display = 'flex'; 
        card.style.alignItems = 'flex-start';
        
        const cardColor = provider.color || '#aaaaaa';
        card.style.borderLeftColor = cardColor; 
        card.style.setProperty('--event-color', cardColor); 
        
        card.innerHTML = `
            <div class="date-container" style="visibility: hidden;">
                <div class="date-day-num">00</div> 
                <div class="date-day-short">XX</div>
            </div>
            <div class="card-content">
                <h3>${provider.name}</h3>
                <p>Info: ${provider.info}</p>
            </div>
        `;
        card.onclick = () => showVeranstalterDetails(provider.id);
        contentDiv.appendChild(card);
    });
}

// --- VERBESSERTE FUNKTION: Drive Link für Anzeige vorbereiten ---

/**
 * Sucht nach einem Google Drive Link in der Beschreibung und konvertiert ihn
 * in ein embed-fähiges Format. Jetzt kompatibel mit 'file/d/...' UND 'open?id=...'.
 */
function getEmbeddableDriveLink(description) {
    // SUCHT NACH DER ID, ENTWEDER IM PFAD ODER HINTER id=. 
    // Der Ausdruck ([^&]+) stellt sicher, dass die ID bis zum nächsten '&' oder zum Ende des Strings erfasst wird.
    const fileIdRegex = /(?:file\/d\/|id=)([^&]+)/;
    const match = description.match(fileIdRegex);
    
    if (match && match[1]) {
        const fileId = match[1];
        // Entfernt ggf. nachfolgende Leerzeichen oder andere störende Zeichen
        const cleanedFileId = fileId.trim(); 
        
        // Konvertiert die File ID in den öffentlichen Embed-Link-Endpunkt
        return `https://drive.google.com/uc?export=view&id=${cleanedFileId}`;
    }
    return null;
}

// --- 5. FUNKTIONEN ZUM ANZEIGEN DER DETAILS (KORRIGIERT: DEBUG) ---

function showEventDetails(event) {
    const provider = providers.find(p => p.id == event.providerId);
    const providerName = provider ? provider.name : "Unbekannter Anbieter";
    const providerColor = provider ? provider.color : '#8B4513'; 
    const safeLinkColor = '#8B4513'; 

    // Prüfung und Konvertierung des Drive-Links
    const imageUrl = getEmbeddableDriveLink(event.description);
    
    // NEU: KONSOLE 1 - Zeigt die ursprüngliche Beschreibung an
    console.log("Originale Event-Beschreibung:", event.description);
    
    // NEU: KONSOLE 2 - Zeigt die umgewandelte Bild-URL an
    console.log("Extrahierte Embed-URL (sollte 'uc?export=view&id=...' enthalten):", imageUrl);
    

    // HTML für das Bild, falls vorhanden
    const imageHtml = imageUrl 
        ? `<div class="event-image-container"><img src="${imageUrl}" alt="Event Anhang" class="event-image"></div>`
        : ''; 

    // ... (Rest der Logik bleibt unverändert) ...
    const timeDisplay = event.endDate ? `${event.date} – ${event.endDate} Uhr` : event.date;
    const locationEncoded = encodeURIComponent(event.location);
    const mapsUrl = `https://www.google.com/maps/search/?api=1&query=${locationEncoded}`; 
    const locationLink = `<a href="${mapsUrl}" target="_blank" style="color: ${safeLinkColor}; font-weight: bold;">${event.location} (Auf Karte anzeigen)</a>`;

    const modalContent = document.getElementById('eventModal').querySelector('.modal-content');
    
    // Wir leeren den Inhalt
    Array.from(modalContent.children).forEach(child => {
        if (!child.classList.contains('close')) {
            child.remove();
        }
    });

    // NEUE STRUKTUR HINZUFÜGEN
    const detailsHTML = `
        <h2 style="color: #8B4513;">${event.title}</h2> 
        ${imageHtml}
        <p><strong>Wann:</strong> ${timeDisplay}</p>
        <p><strong>Wo:</strong> ${locationLink}</p>
        
        <hr style="border-top: 1px solid ${providerColor}; margin: 15px 0;">
        
        <p><strong>Anbieter:</strong> 
            <strong style="color: ${safeLinkColor}; cursor: pointer;" onclick="showVeranstalterDetails(${event.providerId})">
                ${providerName} (Details anzeigen)
            </strong>
        </p>
        <h3 style="margin-top: 20px;">Beschreibung:</h3>
        <p>${event.description.replace(/\n/g, '<br>')}</p>
    `;
    
    modalContent.insertAdjacentHTML('beforeend', detailsHTML);
    eventModal.style.display = "block";
}

    function closeModal(modalId) {
        document.getElementById(modalId).style.display = "none";
    }

// --- 6. NAVIGATION UND START (KORRIGIERT) ---

    function switchView(view) {
        document.getElementById('events-btn').classList.remove('active');
        document.getElementById('providers-btn').classList.remove('active');
        searchInput.value = ''; // Wichtig: Suchfeld beim Wechsel löschen

        if (view === 'events') {
            document.getElementById('events-btn').classList.add('active');
            fetchCalendarEvents(); 
        } else if (view === 'providers') {
            document.getElementById('providers-btn').classList.add('active');
            renderProviderList(); 
        }
    }

	window.onload = () => {
        fetchCalendarEvents();
        // Stellen Sie sicher, dass die Buttons korrekt funktionieren
        document.getElementById('events-btn').onclick = () => switchView('events');
        document.getElementById('providers-btn').onclick = () => switchView('providers');
        
        // NEU: Listener für die Sucheingabe
        searchInput.addEventListener('input', filterEvents);
    };

    window.onclick = function(event) {
        if (event.target == eventModal) {
            eventModal.style.display = "none";
        }
        if (event.target == veranstalterModal) {
            veranstalterModal.style.display = "none";
        }
    }
</script>
</body>
</html>
